---
title: "AI駆動開発でNext.jsのデバッグがdev3000でめちゃくちゃ楽になった件"
emoji: "🛠️"
type: "article"
topics: ["nextjs", "dev3000", "ai", "debug", "workflow"]
published: false
---

## 概要
- Next.js を使った AI 駆動開発で「どこで何が起きているか」を追うのは大変です。dev3000 を使うと、サーバーログ・ブラウザイベント・コンソール・ネットワーク・スクリーンショットが時系列に統合され、デバッグが一気に楽になります。
- 本記事は dev3000 の要点と Next.js プロジェクトでの実践的な使い方を、最短手順でまとめます。

## dev3000 とは（要点）
- サーバー出力、ブラウザのコンソール/エラー、ネットワーク、イベント時のスクショを統合ログとして保存・可視化
- ログビューア: `http://localhost:3684/logs`
- ログ保存: `/var/log/dev3000/`（最新セッションは `/tmp/d3k.log` への symlink）
- MCP サーバー同梱: HTTP 経由でログ検索やブラウザ操作を AI から指示可能
- 参考: [vercel-labs/dev3000](https://github.com/vercel-labs/dev3000)

## クイックスタート（Next.js）
```bash
# グローバルインストール（pnpmも可）
pnpm install -g dev3000 || npm i -g dev3000

# Next.js を起動しながら dev3000 を実行（既定で port 3000 を監視）
dev3000
```
- ブラウザ自動起動（Playwright モード）で、開発中の挙動を自動監視
- ログビューア `http://localhost:3684/logs` を開いてタイムラインを確認

ポートを変えている場合:
```bash
# 例: Next.js を 5173 番で動かす場合
dev3000 --port 5173
```

## 何が“楽”になるのか（Next.js 開発での実感）
- 画面で見えたエラーの直前に、どんなネットワークリクエスト/レスポンスがあったかが一目で分かる
- ルーティングやナビゲーションの「どの瞬間」で失敗したかをスクショで把握できる
- API 500/401、CORS、Hydration error などを「時系列の文脈」で再現・比較できる

## MCP 連携（AI から操作・検索）
MCP サーバーは `http://localhost:3684/api/mcp/mcp` で待ち受け。例として Claude を接続:
```bash
claude mcp add dev3000 http://localhost:3684/api/mcp/mcp
```
使える主なコマンド:
- `read_consolidated_logs`: 直近ログ取得（フィルタ可）
- `search_logs`: 正規表現でログ検索（前後の文脈つき）
- `get_browser_errors`: 一定期間のブラウザエラー抽出
- `execute_browser_action`: ブラウザ操作（navigate/click/screenshot など）

Cursor の設定例:
```json
{
  "mcpServers": {
    "dev3000": {
      "type": "http",
      "url": "http://localhost:3684/api/mcp/mcp"
    }
  }
}
```

## Chrome 拡張 vs Playwright
- 既定: Playwright（自動ブラウザ、全イベントをリッチに取得）
- 代替: Chrome 拡張（軽量・既存のブラウザで監視、`--servers-only` で起動）
```bash
# Chrome 拡張と併用する軽量モード
dev3000 --servers-only
```
用途で選ぶ:
- CI/E2E など自動テスト寄り → Playwright
- 日常の軽快なデバッグ → Chrome 拡張

## Next.js 向けミニ手順（よくあるケース）
1. `pnpm dev` を起動しつつ `dev3000` を別ターミナルで実行
2. 不具合を再現（画面操作）
3. `http://localhost:3684/logs` で時系列を確認
   - Console error → 直後の Network → 対応する Server log を順に追う
4. 必要に応じて MCP の `search_logs` でキーワード/ステータスコード検索
5. 原因箇所を修正 → 再現 → 差分を比較

## 具体例（Hydration error を追う）
- 症状: 画面に Hydration 関連の警告/エラー
- dev3000 で見るポイント:
  - 該当時刻の Console → 直前の Route 変更/Network → Server 側のレンダリングログ
  - スクショでどの画面遷移タイミングかを確認
- 対策: SSR/CSR の境界見直し、非同期データの取得順序調整、クライアント側の条件分岐

## よく使うオプション
```bash
dev3000 [options]
  -p, --port <port>         アプリのポート（既定: 3000）
  --mcp-port <port>         MCP サーバーのポート（既定: 3684）
  -s, --script <script>     実行するパッケージスクリプト（既定: dev）
  --servers-only            サーバーのみ起動（ブラウザ起動なし）
  --profile-dir <dir>       Chrome プロファイルの保存先
```

## まとめ
- Next.js のデバッグで迷子にならない“導線”を dev3000 が用意してくれるため、AI 駆動開発と相性が良いです。
- まずは既定設定で `dev3000` を動かし、ログビューアと MCP を組み合わせて「時系列の文脈」で原因を特定しましょう。

## 参考
- dev3000 リポジトリ: https://github.com/vercel-labs/dev3000
